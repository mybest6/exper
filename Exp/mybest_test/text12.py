#encoding:utf-8
# import json
# html = '''[{ "_index" : "ask-2", "_type" : "doc", "_id" : "55052324", "_score" : 11.101436, "createon" : "2018/7/20 23:33:50", "detail" : "血糖值多少是糖尿病？我家里以前从来没有人得过糖尿病，就是其它的亲戚也没有得这个病的，怎么到我这就得了糖尿病了呢，现在每天都要靠着吃药来控制血糖，除了吃药之外我还需要注意什么呢", "title" : "<em>血糖</em>值多少是<em>糖尿病</em>？", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/55052324.html", "summary" : "<em>血糖</em>值多少是<em>糖尿病</em>？我家里以前从来没有人得过<em>糖尿病</em>，就是其它的亲戚也没有得这个病的，怎么到我这就得了<em>糖尿病</em>了呢，现在每天都要靠着吃药来控制<em>血糖</em>，除了吃药之外我还需要注意什么呢", "publishtime" : "2018-07-20" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "55051637", "_score" : 11.101425, "createon" : "2018/7/20 22:47:30", "detail" : "糖尿病是不是打胰岛素就能降血糖？我的父亲血糖很高，就做了进一步的检查，结果是有糖尿病，一直都在吃药，其他方面还挺好，没有啥不良反应，我想请问一下得了糖尿病会对身体有哪些危害呢？", "title" : "<em>糖尿病</em>是不是打胰岛素就能降<em>血糖</em>？", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/55051637.html", "summary" : "<em>糖尿病</em>是不是打胰岛素就能降<em>血糖</em>？我的父亲<em>血糖</em>很高，就做了进一步的检查，结果是有<em>糖尿病</em>，一直都在吃药，其他方面还挺好，没有啥不良反应，我想请问一下得了<em>糖尿病</em>会对身体有哪些危害呢？", "publishtime" : "2018-07-20" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "54829179", "_score" : 11.101025, "createon" : "2018/7/2 7:39:24", "detail" : "30岁，血糖空腹6.3，得糖尿病可能性大吗", "title" : "30岁，<em>血糖</em>空腹6.3，得<em>糖尿病</em>可能性", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/54829179.html", "summary" : "30岁，<em>血糖</em>空腹6.3，得<em>糖尿病</em>可能性大吗", "publishtime" : "2018-07-02" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "55019067", "_score" : 11.100406, "createon" : "2018/7/17 23:09:01", "detail" : "糖尿病患者，餐后2小时血糖，5.7是不是太低了", "title" : "<em>糖尿病</em>患者，餐后2小时<em>血糖</em>，5.7是不", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/55019067.html", "summary" : "<em>糖尿病</em>患者，餐后2小时<em>血糖</em>，5.7是不是太低了", "publishtime" : "2018-07-17" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "55015163", "_score" : 11.100348, "createon" : "2018/7/17 19:08:00", "detail" : "糖尿病肾病患者，血糖控制在多少，才正常，空腹5.多，餐后8.多", "title" : "<em>糖尿病</em>肾病患者，<em>血糖</em>控制在多少，才正常", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/55015163.html", "summary" : "<em>糖尿病</em>肾病患者，<em>血糖</em>控制在多少，才正常，空腹5.多，餐后8.多", "publishtime" : "2018-07-17" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "54800818", "_score" : 11.100053, "createon" : "2018/6/29 12:51:44", "detail" : "问一下抗β2糖蛋白与糖尿病血糖有关系么", "title" : "问一下抗β2糖蛋白与<em>糖尿病</em><em>血糖</em>有关系么", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/54800818.html", "summary" : "问一下抗β2糖蛋白与<em>糖尿病</em><em>血糖</em>有关系么", "publishtime" : "2018-06-29" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "54793354", "_score" : 11.099815, "createon" : "2018/6/28 20:36:33", "detail" : "血验的没有糖尿病，但是餐前餐后血糖都高，最好餐后26", "title" : "血验的没有<em>糖尿病</em>，但是餐前餐后<em>血糖</em>都高", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/54793354.html", "summary" : "血验的没有<em>糖尿病</em>，但是餐前餐后<em>血糖</em>都高，最好餐后26", "publishtime" : "2018-06-28" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "54984032", "_score" : 11.099501, "createon" : "2018/7/15 7:43:52", "detail" : "一型糖尿病，血糖低的时候抽一根烟可以吧。我现在就是血糖低一天最多才抽三根烟。血糖一旦高了就没抽了，这样可以么", "title" : "一型<em>糖尿病</em>，<em>血糖</em>低的时候抽一根烟可以吧", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/54984032.html", "summary" : "一型<em>糖尿病</em>，<em>血糖</em>低的时候抽一根烟可以吧。我现在就是<em>血糖</em>低一天最多才抽三根烟。<em>血糖</em>一旦高了就没抽了，这样可以么", "publishtime" : "2018-07-15" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "55055924", "_score" : 11.098617, "createon" : "2018/7/21 4:14:00", "detail" : "血糖高一定是糖尿病么？我最近老是感觉到自己嘴巴苦，还有就是老是喝水和上厕所，吃得多但身体变消瘦了。家人非常担心就陪着做了检查，结果医生说是有糖尿病。针对糖尿病应该采取怎样的治疗方法？", "title" : "<em>血糖</em>高一定是<em>糖尿病</em>么？", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/55055924.html", "summary" : "<em>血糖</em>高一定是<em>糖尿病</em>么？我最近老是感觉到自己嘴巴苦，还有就是老是喝水和上厕所，吃得多但身体变消瘦了。家人非常担心就陪着做了检查，结果医生说是有<em>糖尿病</em>。针对<em>糖尿病</em>应该采取怎样的治疗方法？", "publishtime" : "2018-07-21" }, { "_index" : "ask-2", "_type" : "doc", "_id" : "54957166", "_score" : 11.098614, "createon" : "2018/7/12 17:46:13", "detail" : "糖尿病前期2年，一直二甲双瓜控制，血糖一直平稳，餐后血糖5.5-6.8之间，现在发现眼病，这个是糖尿病并发症吗？应该怎么治疗？血压、血脂都不高", "title" : "<em>糖尿病</em>前期2年，一直二甲双瓜控制，<em>血糖</em>一", "channelname" : "39问医生", "channelurl" : "http://ask.39.net", "url" : "http://ask.39.net/question/54957166.html", "summary" : "<em>糖尿病</em>前期2年，一直二甲双瓜控制，<em>血糖</em>一直平稳，餐后<em>血糖</em>5.5-6.8之间，现在发现眼病，这个是<em>糖尿病</em>并发症吗？应该怎么治疗？血压、血脂都不高", "publishtime" : "2018-07-12" }]'''
# a_list = json.loads(html)
# for i in a_list:
#     print(i.get("_id"))
#
#
# def process(res):
#     from lxml import etree
#     root = etree.HTML(res, parser=etree.HTMLParser(encoding="utf-8"))
#     repliess = []
#     root_list = root.xpath('//*[@class="list"]/li')
#     for i in root_list:
#         for q in i.xpath('.//*[@class="q"]'):
#             replies = {'type': '', 'content': '', 'agrees': 0, 'date': '', 'name': '', 'hospital': '', 'profession': '','goodat': ''}
#             replies['type'] = '患者'
#             replies['content'] = q.xpath('.//p/text()')[0].strip()
#             replies['date'] = i.xpath('.//div[@class="date"]/text()')[0].strip()
#             repliess.append(replies)
#         for a in i.xpath('.//*[@class="a"]'):
#             replies = {'type': '', 'content': '', 'agrees': 0, 'date': '', 'name': '', 'hospital': '', 'profession': '','goodat': ''}
#             replies['type'] = '医生'
#             replies['content'] = a.xpath('.//*[@class="container"]/div[@class="about text"]/text()')[0].strip()
#             replies['date'] = a.xpath('.//*[@class="container"]/div[@class="info"]/span[3]/text()')[0].strip()
#             replies['name'] = a.xpath('.//*[@class="container"]/div[@class="info"]/span[1]/text()')[0].strip()
#             replies['hospital'] = root.xpath('//*[@class="info"]//dl[2]//dd//@title')[0].strip()
#             replies['profession'] = root.xpath('//*[@class="info"]/dl/dd/text()')[0].strip()
#             replies['first_class_department'] = "".join(root.xpath('//*[@class="info"]//dl[3]//dd//text()')).strip()
#             replies['goodat'] = root.xpath('//*[@class="info"]/dl/dd[@class="word-break"]/span/span/text()')[0].strip()
#             repliess.append(replies)
#     return repliess
def process(res):
    from lxml import etree
    root = etree.HTML(res, parser=etree.HTMLParser(encoding="utf-8"))
    repliess = []
    root_list = root.xpath('//*[@class="list"]/li')
    for i in root_list:
        for q in i.xpath('.//*[@class="q"]'):
            replies = {'type': '', 'content': '', 'agrees': 0, 'date': '', 'name': '', 'hospital': '', 'profession': '','goodat': ''}
            replies['type'] = '患者'
            replies['content'] = q.xpath('.//p/text()')[0].strip()
            replies['date'] = i.xpath('.//div[@class="date"]/text()')[0].strip()
            repliess.append(replies)
        for a in i.xpath('.//*[@class="a"]'):
            replies = {'type': '', 'content': '', 'agrees': 0, 'date': '', 'name': '', 'hospital': '', 'profession': '','goodat': ''}
            replies['type'] = '医生'
            replies['content'] = a.xpath('.//*[@class="container"]/div[@class="about text"]/text()')[0].strip()
            replies['date'] = a.xpath('.//*[@class="container"]/div[@class="info"]/span[3]/text()')[0].strip()
            replies['name'] = a.xpath('.//*[@class="container"]/div[@class="info"]/span[1]/text()')[0].strip()
            replies['hospital'] = root.xpath('//*[@class="info"]//dl[2]//dd//@title')[0].strip()
            replies['profession'] = root.xpath('//*[@class="info"]/dl/dd/text()')[0].strip()
            replies['first_class_department'] = "".join(root.xpath('//*[@class="info"]//dl[3]//dd//text()')).strip()
            replies['goodat'] = root.xpath('//*[@class="info"]/dl/dd[@class="word-break"]/span/span/text()')[0].strip()
            repliess.append(replies)
    return repliess